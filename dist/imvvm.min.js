!function(b){if("object"==typeof exports){module.exports=b()}else{if("function"==typeof define&&define.amd){define(b)}else{var a;"undefined"!=typeof window?a=window:"undefined"!=typeof global?a=global:"undefined"!=typeof self&&(a=self),a.IMVVM=b()}}}(function(){var d,b,a;return(function c(f,k,h){function g(n,l){if(!k[n]){if(!f[n]){var i=typeof require=="function"&&require;if(!l&&i){return i(n,!0)}if(e){return e(n,!0)}throw new Error("Cannot find module '"+n+"'")}var m=k[n]={exports:{}};f[n][0].call(m.exports,function(o){var p=f[n][1][o];return g(p?p:o)},m,m.exports,c,f,k,h)}return k[n].exports}var e=typeof require=="function"&&require;for(var j=0;j<h.length;j++){g(h[j])}return g})({1:[function(h,g,f){var e=h("./src/imvvm.js");g.exports=e},{"./src/imvvm.js":3}],2:[function(h,g,f){var e=h("./utils");var i=e.extend;f.getInitialState=function(k,l,s,C){if(typeof s!=="function"){throw new TypeError()}var D,x={},q={},A,v={},u=[],E;var o;var j;var m;var z;var y;C===void (0)?false:C;var B=function(I,H){var G={};for(var F in I){if(I.hasOwnProperty(F)){if(Object.prototype.toString.call(I[F])==="[object Object]"){G[F]=I[F]}else{G[F]={};G[F][H]=I[F]}}}return G};var p=function(I,G){var K={},J,F;G=("dependsOn" in G)?G:{dependsOn:G};for(var H in G.dependsOn){if(G.dependsOn.hasOwnProperty(H)){F={};J=G.dependsOn[H].property.split(".");J.forEach(function(M,L){if(L===0){F=I[M]}else{F=F?F[M]:void (0)}});K[H]=F}}return K};var w=function(G,N,K,M){var H=false,J;N=N||{};K=K||{};if(G!==k){N[G]=new q[G](N[G],p(N,E[G]),K[G])}if(M){var L={};if(!!j){L=p(N,j);N=i(N,L);for(var I in j){if(j.hasOwnProperty(I)&&("onStateChange" in j[I])){var F={};F[I]=N[I];N=i(N,j[I].onStateChange(F))}}}N=new D(i(N,L),K,C);M.subscribers.forEach(function(O){if(O!==k){N[O]=new q[O](N[O],p(N,E[O]),K[O])}})}return N};var n=function(F,H,Q){var T={},N={},S=void (0),M,L,R;if(
/*!initialize && */
(H===void (0)||H===null||Object.keys(H).length===0)){return}var K=!!H?Object.getPrototypeOf(H).constructor.classType==="DomainModel":false;if(K){T=i(H);N=H.previousState}else{if(F in v){M=Object.keys(H);L=M.length;R={};for(var J=0;J<L;J++){if(v[F][M[J]]){for(var G=0,I=v[F][M[J]].length;G<I;G++){R[v[F][M[J]][G].dataContext]=true}}}S={};S.name=F;S.subscribers=Object.keys(R);S=!!S.subscribers.length?S:void (0)}var P;var O;if(F!==k){T[F]=H;T=i(x.state,T);if(S&&S.subscribers){S.subscribers.forEach(function(Y){for(P=0;P<L;P++){if(v[F][M[P]]){var X=v[F][M[P]];var Z=X.length;for(O=0;O<Z;O++){var V=X[O].dataContext===k?j:E[X[O].dataContext].dependsOn;if(V[X[O].alias].onStateChange){var U={};U[X[O].alias]=T[F][M[P]];var W=V[X[O].alias].onStateChange.call(x.state[X[O].dataContext],U);if(Object.prototype.toString.call(W)==="[object Object]"){if(X[O].dataContext===k){T=i(T,W)}else{T[X[O].dataContext]=i(T[X[O].dataContext],W)}}}}}}})}}else{T=i(x.state,H)}N=x;T=w(F,T,x.state,S)}if(!!N){Object.freeze(N)}x=new D(T,N,C);Object.freeze(x);Object.freeze(x.state);s(x,F,Q);return x};D=l.call(this,n.bind(this,k));x=new D({},void (0),C,true);j=x.getDependencies?B(x.getDependencies(),"property"):void (0);if(j){u.push(k);for(o in j){if(j.hasOwnProperty(o)){A=j[o].property.split(".");m=A.length;z=m>1?A[0]:k;y=m>1?A[1]:A[0];v[z]=v[z]||{};v[z][y]=v[z][y]||[];if(v[z][y].indexOf(k)===-1){v[z][y].push({dataContext:k,alias:o})}}}}E=B(x.getDomainDataContext(),"viewModel");for(var r in E){if(E.hasOwnProperty(r)){q[r]=E[r].viewModel.call(this,n.bind(this,r));x[r]=new q[r]({},{},{},true);if(x[r].getDependencies){u.push(r);E[r].dependsOn=B(x[r].getDependencies(),"property");for(o in E[r].dependsOn){if(E[r].dependsOn.hasOwnProperty(o)){A=E[r].dependsOn[o].property.split(".");m=A.length;z=m>1?A[0]:k;y=m>1?A[1]:A[0];v[z]=v[z]||{};v[z][y]=v[z][y]||[];if(v[z][y].indexOf(r)===-1){v[z][y].push({dataContext:r,alias:o})}}}}}}u.forEach(function(F){if(F!==k){x[F]=new q[F](x[F],p(x,E[F]),{})}});var t=!!j?p(x,j):{};x=new D(i(x,t),void (0),C);return Object.freeze(x)}},{"./utils":8}],3:[function(f,g,j){var k=f("./imvvmModel");var p=f("./imvvmViewModel");var i=f("./imvvmDomainModel");var r=f("./mixin");var q=f("./utils");var n=q.extend;var m=q.mixInto;var l=function(){};var h=function(){};var o=function(){};m(l,k.Mixin);m(h,p.Mixin);m(o,i.Mixin);var e={createClass:function(u,v,t){var y=function(){};y.prototype=new u();y.prototype.constructor=y;var x=y;var w=function(z){var A=new x();return A.construct.apply(w,arguments)};w.componentConstructor=y;y.ConvenienceConstructor=w;w.originalSpec=t;w.type=y;y.prototype.type=y;w.classType=v;y.prototype.classType=v;return w}};var s={createModel:e.createClass.bind(this,l,"Model"),createViewModel:e.createClass.bind(this,h,"ViewModel"),createDomainModel:e.createClass.bind(this,o,"DomainModel"),mixin:r};g.exports=s},{"./imvvmDomainModel":4,"./imvvmModel":5,"./imvvmViewModel":6,"./mixin":7,"./utils":8}],4:[function(j,h,f){var e=j("./utils");var k=e.extend;var g=e.getDescriptor;var i={Mixin:{construct:function(m){var n=g.call(this);n.proto.setState=m;var l=function(s,u,p,o){var q=Object.create(n.proto,n.descriptor);s=s||{};if(!p&&!!u){Object.defineProperty(q,"previousState",{configurable:false,enumerable:false,writable:false,value:u})}u=u||{};if(o&&("getInitialState" in n.proto)){Object.defineProperty(q,"state",{configurable:true,enumerable:false,writable:true,value:s});s=k(s,n.proto.getInitialState.call(q))}var t=Object.keys(s);for(var r=t.length-1;r>=0;r--){if(!(t[r] in q)){q[t[r]]=s[t[r]]}}Object.defineProperty(q,"state",{configurable:false,enumerable:false,writable:false,value:s});return q};return l}}};h.exports=i},{"./utils":8}],5:[function(i,h,f){var e=i("./utils");var k=e.extend;var g=e.getDescriptor;var j={Mixin:{construct:function(m){var n=g.call(this);var l=function(s,t,p){var q=Object.create(n.proto,n.descriptor);var u=arguments.length;var r=typeof Array.prototype.slice.call(arguments,-1)[0]==="boolean";var o=false;if(u===0){s={};t={};p=false}else{if(u===1){if(r){p=s;s={};t={}}else{t={};p=false;o=true}}else{if(u===2){if(r){p=t;t={};o=true}else{p=false}}}}s=("state" in s)?s.state:s;t=("state" in t)?t.state:t;Object.defineProperty(q,"state",{configurable:true,enumerable:false,writable:true,value:s});if(o&&!!n.originalSpec.getInitialState){s=k(s,n.originalSpec.getInitialState.call(q))}if(p){Object.defineProperty(q,"context",{configurable:true,enumerable:true,set:function(v){this.setState=function(w,x){return m.bind(v).call(v,k(this.state,w),this.state,x)}.bind(this);delete this.context}})}Object.defineProperty(q,"state",{configurable:false,enumerable:false,writable:false,value:s});Object.keys(q).forEach(function(v){if(Object.prototype.toString.call(this[v])==="[object Object]"||Object.prototype.toString.call(this[v])==="[object Array]"){Object.freeze(this[v])}}.bind(q));if(!p){Object.freeze(q)}return q};return l}}};h.exports=j},{"./utils":8}],6:[function(j,i,g){var f=j("./utils");var k=f.extend;var h=f.getDescriptor;var e={Mixin:{construct:function(m){var o=h.call(this);o.proto.setState=m;var n=0;var l=function(r,s,u,p){var v;console.log("COUNT - "+ ++n);r=k(r,s);u=u||{};u=("state" in u)?u.state:u;var q=Object.create(o.proto,o.descriptor);Object.defineProperty(q,"state",{configurable:true,enumerable:false,writable:true,value:r});r=k(r,q);if(p){if(o.proto.getInitialState){r=k(r,o.proto.getInitialState())}}Object.defineProperty(q,"state",{configurable:false,enumerable:false,writable:false,value:r});Object.keys(q).forEach(function(w){if(Object.prototype.toString.call(this[w])==="[object Object]"&&("context" in this[w])){this[w].context=this;Object.freeze(this[w])}else{if(Object.prototype.toString.call(this[w])==="[object Array]"){Object.freeze(this[w])}}}.bind(q));for(var t in s){if(s.hasOwnProperty(t)&&t[0]!=="_"){Object.defineProperty(q,t,{configurable:false,enumerable:false,writable:false,value:s[t]})}}Object.freeze(r);return Object.freeze(q)};return l}}};i.exports=e},{"./utils":8}],7:[function(j,i,h){var f=j("./core");var e="__IMVVM__";var g={stateChangedHandler:function(k,l,m){this.setState({applicationDataContext:k},function(){if(typeof m==="function"){if(this.state===null||!("applicationDataContext" in this.state)){m(void (0))}else{if(l in this.state.applicationDataContext){m(this.state.applicationDataContext[l])}else{if(l===e){m(this.state.applicationDataContext)}else{m(void (0))}}}}}.bind(this))},getInitialState:function(){var k=f.getInitialState(e,this.props.domainModel,this.stateChangedHandler,this.props.disableUndo);return{applicationDataContext:k}}};i.exports=g},{"./core":2}],8:[function(h,g,f){var e={getDescriptor:function(){var l={};var k=this.prototype;var i=[];for(var j in this.originalSpec){if(this.originalSpec.hasOwnProperty(j)){if("get" in this.originalSpec[j]||"set" in this.originalSpec[j]){this.originalSpec[j].enumerable=true;if("kind" in this.originalSpec[j]){if(this.originalSpec[j].kind==="pseudo"){this.originalSpec[j].enumerable=false}else{i.push({fieldName:j,kind:this.originalSpec[j].kind})}delete this.originalSpec[j].kind}l[j]=this.originalSpec[j]}else{k[j]=this.originalSpec[j]}}}if(!("extend" in k)){k.extend=e.extend}return{descriptor:l,proto:k,originalSpec:this.originalSpec||{},freezeFields:i}},extend:function(){var j={};for(var l=0;l<arguments.length;l++){var m=arguments[l];for(var k in m){if(m.hasOwnProperty(k)){j[k]=m[k]}}}return j},mixInto:function(j,k){var i;for(i in k){if(!k.hasOwnProperty(i)){continue}j.prototype[i]=k[i]}}};g.exports=e},{}]},{},[1])(1)});
!function(b){if("object"==typeof exports){module.exports=b()}else{if("function"==typeof define&&define.amd){define(b)}else{var a;"undefined"!=typeof window?a=window:"undefined"!=typeof global?a=global:"undefined"!=typeof self&&(a=self),a.IMVVM=b()}}}(function(){var d,b,a;return(function c(f,k,h){function g(n,l){if(!k[n]){if(!f[n]){var i=typeof require=="function"&&require;if(!l&&i){return i(n,!0)}if(e){return e(n,!0)}throw new Error("Cannot find module '"+n+"'")}var m=k[n]={exports:{}};f[n][0].call(m.exports,function(o){var p=f[n][1][o];return g(p?p:o)},m,m.exports,c,f,k,h)}return k[n].exports}var e=typeof require=="function"&&require;for(var j=0;j<h.length;j++){g(h[j])}return g})({1:[function(h,g,f){var e=h("./src/imvvm.js");g.exports=e},{"./src/imvvm.js":3}],2:[function(h,g,f){var e=h("./utils");var i=e.extend;f.getInitialState=function(l,m,u,k){if(typeof u!=="function"){throw new TypeError()}k===void (0)?true:k;var B,j,t={},r={},y,n,w={},v=[],D,q,p;var z;var A=function(H,G){var F={};for(var E in H){if(H.hasOwnProperty(E)){if(Object.prototype.toString.call(H[E])==="[object Object]"){F[E]=H[E]}else{F[E]={};F[E][G]=H[E]}}}return F};var C=function(H,F){var J={},I,E;if(!F){return{}}F=("dependsOn" in F)?F:{dependsOn:F};for(var G in F.dependsOn){if(F.dependsOn.hasOwnProperty(G)){E={};I=F.dependsOn[G].property.split(".");I.forEach(function(L,K){if(K===0){E=H[L]}else{E=E?E[L]:void (0)}});J[G]=E}}return J};var x=function(E,J,F,I){F=F||{};var L=false,K,G;if(E!==l){F[E]=new r[E](F[E],C(F,D[E]))}if(J){if(!!j){K=C(F,j);F=i(F,K);for(var H in j){if(j.hasOwnProperty(H)&&("onStateChange" in j[H])){G={};G[H]=F[H];F=i(F,j[H].onStateChange(G))}}}F=new B(i(F,K),I,k);J.forEach(function(M){if(M!==l){F[M]=new r[M](F[M],C(F,D[M]))}})}return F};var o=function(G,I,S){if((I===void (0)||I===null||Object.keys(I).length===0)){return}var T={},R={},E=[],P,K,N,F,O,L={},Q,M;if(Object.getPrototypeOf(I).constructor.classType==="DomainModel"){T=i(I);R=I.previousState}else{if(G in w){P=Object.keys(I);K=P.length;N={};for(var J=K-1;J>=0;J--){if(w[G][P[J]]){for(var H=w[G][P[J]].length-1;H>=0;H--){N[w[G][P[J]][H].dataContext]=true}}}E=Object.keys(N);hasSubscribers=!!E.length}if(G!==l){T[G]=I;T=i(t.state,T);if(hasSubscribers){E.forEach(function(V){for(F=K-1;F>=0;F--){if(w[G][P[F]]){var U=w[G][P[F]];for(O=U.length-1;O>=0;O--){M=U[O].dataContext===l?j:D[U[O].dataContext].dependsOn;if(M[U[O].alias].onStateChange){L[U[O].alias]=T[G][P[F]];Q=M[U[O].alias].onStateChange.call(t.state[U[O].dataContext],L);if(Object.prototype.toString.call(Q)==="[object Object]"){if(U[O].dataContext===l){T=i(T,Q)}else{T[U[O].dataContext]=i(T[U[O].dataContext],Q)}}}}}}})}}else{T=i(t.state,I)}R=t;T=x(G,hasSubscribers?E:false,T,t.state)}if(!!R){Object.freeze(R)}t=new B(T,R,k);Object.freeze(t);Object.freeze(t.state);u(t,G,S);return t};B=m.call(this,o.bind(this,l));t=new B({},void (0),k,true);j=t.getDependencies?A(t.getDependencies(),"property"):void (0);if(j){v.push(l);for(z in j){if(j.hasOwnProperty(z)){y=j[z].property.split(".");n=y.length;q=n>1?y[0]:l;p=n>1?y[1]:y[0];w[q]=w[q]||{};w[q][p]=w[q][p]||[];if(w[q][p].indexOf(l)===-1){w[q][p].push({dataContext:l,alias:z})}}}}D=A(t.getDomainDataContext(),"viewModel");for(var s in D){if(D.hasOwnProperty(s)){r[s]=D[s].viewModel.call(this,o.bind(this,s));t[s]=new r[s]({},{},true);if(t[s].getDependencies){v.push(s);D[s].dependsOn=A(t[s].getDependencies(),"property");for(z in D[s].dependsOn){if(D[s].dependsOn.hasOwnProperty(z)){y=D[s].dependsOn[z].property.split(".");n=y.length;q=n>1?y[0]:l;p=n>1?y[1]:y[0];w[q]=w[q]||{};w[q][p]=w[q][p]||[];if(w[q][p].indexOf(s)===-1){w[q][p].push({dataContext:s,alias:z})}}}}}}v.forEach(function(E){if(E!==l){t[E]=new r[E](t[E],C(t,D[E]))}});t=new B(i(t,C(t,j)),void (0),k);Object.freeze(t.state);return Object.freeze(t)}},{"./utils":8}],3:[function(f,g,j){var k=f("./imvvmModel");var p=f("./imvvmViewModel");var i=f("./imvvmDomainModel");var r=f("./mixin");var q=f("./utils");var n=q.extend;var m=q.mixInto;var l=function(){};var h=function(){};var o=function(){};m(l,k.Mixin);m(h,p.Mixin);m(o,i.Mixin);var e={createClass:function(u,v,t){var y=function(){};y.prototype=new u();y.prototype.constructor=y;var x=y;var w=function(z){var A=new x();return A.construct.apply(w,arguments)};w.componentConstructor=y;y.ConvenienceConstructor=w;w.originalSpec=t;w.type=y;y.prototype.type=y;w.classType=v;y.prototype.classType=v;w.getDescriptor=function(){var C={};var B=this.prototype;var z=[];if("__processedObject__" in this.originalSpec){return this.originalSpec.__processedObject__}for(var A in this.originalSpec){if(this.originalSpec.hasOwnProperty(A)){if("get" in this.originalSpec[A]||"set" in this.originalSpec[A]){this.originalSpec[A].enumerable=true;if("kind" in this.originalSpec[A]){if(this.originalSpec[A].kind==="pseudo"){this.originalSpec[A].enumerable=false}else{z.push({fieldName:A,kind:this.originalSpec[A].kind})}delete this.originalSpec[A].kind}C[A]=this.originalSpec[A]}else{B[A]=this.originalSpec[A]}}}if(!("extend" in B)){B.extend=q.extend}this.originalSpec.__processedObject__={descriptor:C,proto:B,originalSpec:this.originalSpec||{},freezeFields:z};return this.originalSpec.__processedObject__};return w}};var s={createModel:e.createClass.bind(this,l,"Model"),createViewModel:e.createClass.bind(this,h,"ViewModel"),createDomainModel:e.createClass.bind(this,o,"DomainModel"),mixin:r};g.exports=s},{"./imvvmDomainModel":4,"./imvvmModel":5,"./imvvmViewModel":6,"./mixin":7,"./utils":8}],4:[function(j,h,f){var e=j("./utils");var k=e.extend;var g=e.getDescriptor;var i={Mixin:{construct:function(m){var n=this.getDescriptor(this);n.proto.setState=m;var l=function(w,u,o,t){var q=n.freezeFields;var r=Object.create(n.proto,n.descriptor);Object.defineProperty(r,"state",{configurable:true,enumerable:false,writable:true,value:w});if(!!o&&!!u){Object.defineProperty(r,"previousState",{configurable:false,enumerable:false,writable:false,value:u})}u=u||{};if(t&&("getInitialState" in r)){w=k(w,r.getInitialState.call(r))}var v=Object.keys(w);for(var s=v.length-1;s>=0;s--){if(!(v[s] in r)){r[v[s]]=w[v[s]]}}Object.defineProperty(r,"state",{configurable:false,enumerable:false,writable:false,value:w});for(var p=q.length-1;p>=0;p--){Object.freeze(r[q[p].fieldName])}return r};return l}}};h.exports=i},{"./utils":8}],5:[function(i,h,f){var e=i("./utils");var k=e.extend;var g=e.getDescriptor;var j={Mixin:{construct:function(m){var n=this.getDescriptor(this);n.proto.__stateChangedHandler=m;var l=function(r){var s=n.freezeFields;var p=Object.create(n.proto,n.descriptor);var o=false;r=r||{};if("state" in r){r=r.state}else{o=true}Object.defineProperty(p,"state",{configurable:true,enumerable:false,writable:true,value:r});if(o&&("getInitialState" in p)){r=k(r,p.getInitialState.call(p))}Object.defineProperty(p,"state",{configurable:false,enumerable:false,writable:false,value:r});for(var q=s.length-1;q>=0;q--){Object.freeze(p[s[q].fieldName])}return Object.freeze(p)};return l}}};h.exports=j},{"./utils":8}],6:[function(j,i,g){var f=j("./utils");var k=f.extend;var h=f.getDescriptor;var e={Mixin:{construct:function(m){var n=this.getDescriptor(this);n.proto.setState=m;var l=function(y,t,r){y=k(y,t);var o=n.freezeFields;var w=Object.create(n.proto,n.descriptor);var s={};var x,u;Object.defineProperty(w,"state",{configurable:true,enumerable:false,writable:true,value:y});if(r&&("getInitialState" in w)){y=k(y,w.getInitialState.call(w))}Object.defineProperty(w,"state",{configurable:false,enumerable:false,writable:false,value:y});for(var q=o.length-1;q>=0;q--){if(o[q].kind==="instance"){x=Object.getOwnPropertyNames(w[o[q].fieldName]);for(var p=x.length-1;p>=0;p--){s[x[p]]=Object.getOwnPropertyDescriptor(w[o[q].fieldName],x[p])}u=Object.create(w[o[q].fieldName].__proto__,s);Object.defineProperty(u,"state",{configurable:false,enumerable:false,writable:false,value:w[o[q].fieldName].state});u.__proto__.setState=function(z,A){return this.__stateChangedHandler.bind(w).call(w,k(this.state,z),this.state,A)}.bind(u);w[o[q].fieldName]=Object.freeze(u)}else{Object.freeze(w[o[q].fieldName])}}for(var v in t){if(t.hasOwnProperty(v)&&v[0]!=="_"){Object.defineProperty(w,v,{configurable:false,enumerable:false,writable:false,value:t[v]})}}Object.freeze(y);return Object.freeze(w)};return l}}};i.exports=e},{"./utils":8}],7:[function(j,i,h){var f=j("./core");var e="__IMVVM__";var g={stateChangedHandler:function(k,l,m){this.setState({domainDataContext:k},function(){if(typeof m==="function"){if(this.state===null||!("domainDataContext" in this.state)){m(void (0))}else{if(l in this.state.domainDataContext){m(this.state.domainDataContext[l])}else{if(l===e){m(this.state.domainDataContext)}else{m(void (0))}}}}}.bind(this))},getInitialState:function(){var k=f.getInitialState(e,this.props.domainModel,this.stateChangedHandler,this.props.enableUndo);return{domainDataContext:k}}};i.exports=g},{"./core":2}],8:[function(h,g,f){var e={extend:function(){var j={};for(var l=0;l<arguments.length;l++){var m=arguments[l];for(var k in m){if(m.hasOwnProperty(k)){j[k]=m[k]}}}return j},mixInto:function(j,k){var i;for(i in k){if(!k.hasOwnProperty(i)){continue}j.prototype[i]=k[i]}}};g.exports=e},{}]},{},[1])(1)});
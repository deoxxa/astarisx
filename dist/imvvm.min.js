!function(b){if("object"==typeof exports){module.exports=b()}else{if("function"==typeof define&&define.amd){define(b)}else{var a;"undefined"!=typeof window?a=window:"undefined"!=typeof global?a=global:"undefined"!=typeof self&&(a=self),a.IMVVM=b()}}}(function(){var d,b,a;return(function c(f,k,h){function g(n,l){if(!k[n]){if(!f[n]){var i=typeof require=="function"&&require;if(!l&&i){return i(n,!0)}if(e){return e(n,!0)}throw new Error("Cannot find module '"+n+"'")}var m=k[n]={exports:{}};f[n][0].call(m.exports,function(o){var p=f[n][1][o];return g(p?p:o)},m,m.exports,c,f,k,h)}return k[n].exports}var e=typeof require=="function"&&require;for(var j=0;j<h.length;j++){g(h[j])}return g})({1:[function(h,g,f){var e=h("./src/imvvm.js");g.exports=e},{"./src/imvvm.js":3}],2:[function(h,g,f){var e=h("./utils");var i=e.extend;f.getInitialState=function(l,m,v,k){if(typeof v!=="function"){throw new TypeError()}k===void (0)?true:k;var C,j,t={},r={},z,n,x={},w=[],D,q,p;var B;var A=function(H,G){var F={};for(var E in H){if(H.hasOwnProperty(E)){if(Object.prototype.toString.call(H[E])==="[object Object]"){F[E]=H[E]}else{F[E]={};F[E][G]=H[E]}}}return F};var u=function(H,F){var J={},I,E;if(!F){return{}}F=("dependsOn" in F)?F:{dependsOn:F};for(var G in F.dependsOn){if(F.dependsOn.hasOwnProperty(G)){E={};I=F.dependsOn[G].property.split(".");I.forEach(function(L,K){if(K===0){E=H[L]}else{E=E?E[L]:void (0)}});J[G]=E}}return J};var y=function(F,M,J,L){M=M||{};J=J||{};var G=false,I,K,E;if(F!==l){M[F]=new r[F](M[F],u(M,D[F]),J[F])}if(L){if(!!j){K=u(M,j);M=i(M,K);for(var H in j){if(j.hasOwnProperty(H)&&("onStateChange" in j[H])){E={};E[H]=M[H];M=i(M,j[H].onStateChange(E))}}}M=new C(i(M,K),J,k);L.subscribers.forEach(function(N){if(N!==l){M[N]=new r[N](M[N],u(M,D[N]),J[N])}})}return M};var o=function(E,G,O){if((G===void (0)||G===null||Object.keys(G).length===0)){return}var R={},L={},Q=void (0),K,J,P;if(Object.getPrototypeOf(G).constructor.classType==="DomainModel"){R=i(G);L=G.previousState}else{if(E in x){K=Object.keys(G);J=K.length;P={};for(var I=0;I<J;I++){if(x[E][K[I]]){for(var F=0,H=x[E][K[I]].length;F<H;F++){P[x[E][K[I]][F].dataContext]=true}}}Q={};Q.name=E;Q.subscribers=Object.keys(P);Q=!!Q.subscribers.length?Q:void (0)}var N;var M;if(E!==l){R[E]=G;R=i(t.state,R);if(Q&&Q.subscribers){Q.subscribers.forEach(function(W){for(N=0;N<J;N++){if(x[E][K[N]]){var V=x[E][K[N]];var X=V.length;for(M=0;M<X;M++){var T=V[M].dataContext===l?j:D[V[M].dataContext].dependsOn;if(T[V[M].alias].onStateChange){var S={};S[V[M].alias]=R[E][K[N]];var U=T[V[M].alias].onStateChange.call(t.state[V[M].dataContext],S);if(Object.prototype.toString.call(U)==="[object Object]"){if(V[M].dataContext===l){R=i(R,U)}else{R[V[M].dataContext]=i(R[V[M].dataContext],U)}}}}}}})}}else{R=i(t.state,G)}L=t;R=y(E,R,t.state,Q)}if(!!L){Object.freeze(L)}t=new C(R,L,k);Object.freeze(t);Object.freeze(t.state);v(t,E,O);return t};C=m.call(this,o.bind(this,l));t=new C({},void (0),k,true);j=t.getDependencies?A(t.getDependencies(),"property"):void (0);if(j){w.push(l);for(B in j){if(j.hasOwnProperty(B)){z=j[B].property.split(".");n=z.length;q=n>1?z[0]:l;p=n>1?z[1]:z[0];x[q]=x[q]||{};x[q][p]=x[q][p]||[];if(x[q][p].indexOf(l)===-1){x[q][p].push({dataContext:l,alias:B})}}}}D=A(t.getDomainDataContext(),"viewModel");for(var s in D){if(D.hasOwnProperty(s)){r[s]=D[s].viewModel.call(this,o.bind(this,s));t[s]=new r[s]({},{},{},true);if(t[s].getDependencies){w.push(s);D[s].dependsOn=A(t[s].getDependencies(),"property");for(B in D[s].dependsOn){if(D[s].dependsOn.hasOwnProperty(B)){z=D[s].dependsOn[B].property.split(".");n=z.length;q=n>1?z[0]:l;p=n>1?z[1]:z[0];x[q]=x[q]||{};x[q][p]=x[q][p]||[];if(x[q][p].indexOf(s)===-1){x[q][p].push({dataContext:s,alias:B})}}}}}}w.forEach(function(E){if(E!==l){t[E]=new r[E](t[E],u(t,D[E]),{})}});t=new C(i(t,u(t,j)),void (0),k);Object.freeze(t.state);return Object.freeze(t)}},{"./utils":8}],3:[function(f,g,j){var k=f("./imvvmModel");var p=f("./imvvmViewModel");var i=f("./imvvmDomainModel");var r=f("./mixin");var q=f("./utils");var n=q.extend;var m=q.mixInto;var l=function(){};var h=function(){};var o=function(){};m(l,k.Mixin);m(h,p.Mixin);m(o,i.Mixin);var e={createClass:function(u,v,t){var y=function(){};y.prototype=new u();y.prototype.constructor=y;var x=y;var w=function(z){var A=new x();return A.construct.apply(w,arguments)};w.componentConstructor=y;y.ConvenienceConstructor=w;w.originalSpec=t;w.type=y;y.prototype.type=y;w.classType=v;y.prototype.classType=v;return w}};var s={createModel:e.createClass.bind(this,l,"Model"),createViewModel:e.createClass.bind(this,h,"ViewModel"),createDomainModel:e.createClass.bind(this,o,"DomainModel"),mixin:r};g.exports=s},{"./imvvmDomainModel":4,"./imvvmModel":5,"./imvvmViewModel":6,"./mixin":7,"./utils":8}],4:[function(j,h,f){var e=j("./utils");var k=e.extend;var g=e.getDescriptor;var i={Mixin:{construct:function(m){var n=g.call(this);n.proto.setState=m;var l=function(w,u,o,t){var q=n.freezeFields;var r=Object.create(n.proto,n.descriptor);Object.defineProperty(r,"state",{configurable:true,enumerable:false,writable:true,value:w});if(!!o&&!!u){Object.defineProperty(r,"previousState",{configurable:false,enumerable:false,writable:false,value:u})}u=u||{};if(t&&("getInitialState" in r)){w=k(w,r.getInitialState.call(r))}var v=Object.keys(w);for(var s=v.length-1;s>=0;s--){if(!(v[s] in r)){r[v[s]]=w[v[s]]}}Object.defineProperty(r,"state",{configurable:false,enumerable:false,writable:false,value:w});for(var p=q.length-1;p>=0;p--){Object.freeze(r[q[p].fieldName])}return r};return l}}};h.exports=i},{"./utils":8}],5:[function(i,h,f){var e=i("./utils");var k=e.extend;var g=e.getDescriptor;var j={Mixin:{construct:function(m){var n=g.call(this);var l=function(w,v,o){var p=n.freezeFields;var t=Object.create(n.proto,n.descriptor);var r=arguments.length;var u=typeof Array.prototype.slice.call(arguments,-1)[0]==="boolean";var s=false;if(r===0){w={};v={};o=false}else{if(r===1){if(u){o=w;w={};v={}}else{v={};o=false;s=true}}else{if(r===2){if(u){o=v;v={};s=true}else{o=false}}}}w=("state" in w)?w.state:w;v=("state" in v)?v.state:v;Object.defineProperty(t,"state",{configurable:true,enumerable:false,writable:true,value:w});if(s&&("getInitialState" in t)){w=k(w,t.getInitialState.call(t))}if(o){Object.defineProperty(t,"context",{configurable:true,enumerable:false,set:function(x){this.setState=function(y,z){return m.bind(x).call(x,k(this.state,y),this.state,z)}.bind(this);delete this.context}})}Object.defineProperty(t,"state",{configurable:false,enumerable:false,writable:false,value:w});for(var q=p.length-1;q>=0;q--){Object.freeze(t[p[q].fieldName])}if(!o){Object.freeze(t)}return t};return l}}};h.exports=j},{"./utils":8}],6:[function(j,i,g){var f=j("./utils");var k=f.extend;var h=f.getDescriptor;var e={Mixin:{construct:function(m){var n=h.call(this);n.proto.setState=m;var l=function(r,t,v,o){r=k(r,t);v=v||{};v=("state" in v)?v.state:v;var s=n.freezeFields;var p=Object.create(n.proto,n.descriptor);Object.defineProperty(p,"state",{configurable:true,enumerable:false,writable:true,value:r});if(o&&("getInitialState" in p)){r=k(r,p.getInitialState.call(p))}Object.defineProperty(p,"state",{configurable:false,enumerable:false,writable:false,value:r});for(var q=s.length-1;q>=0;q--){if(s[q].kind==="instance"&&("context" in p[s[q].fieldName])){p[s[q].fieldName].context=p}Object.freeze(p[s[q].fieldName])}for(var u in t){if(t.hasOwnProperty(u)&&u[0]!=="_"){Object.defineProperty(p,u,{configurable:false,enumerable:false,writable:false,value:t[u]})}}Object.freeze(r);return Object.freeze(p)};return l}}};i.exports=e},{"./utils":8}],7:[function(j,i,h){var f=j("./core");var e="__IMVVM__";var g={stateChangedHandler:function(k,l,m){this.setState({domainDataContext:k},function(){if(typeof m==="function"){if(this.state===null||!("domainDataContext" in this.state)){m(void (0))}else{if(l in this.state.domainDataContext){m(this.state.domainDataContext[l])}else{if(l===e){m(this.state.domainDataContext)}else{m(void (0))}}}}}.bind(this))},getInitialState:function(){var k=f.getInitialState(e,this.props.domainModel,this.stateChangedHandler,this.props.enableUndo);return{domainDataContext:k}}};i.exports=g},{"./core":2}],8:[function(h,g,f){var e={getDescriptor:function(){var l={};var k=this.prototype;var i=[];if("__processedObject__" in this.originalSpec){return this.originalSpec.__processedObject__}for(var j in this.originalSpec){if(this.originalSpec.hasOwnProperty(j)){if("get" in this.originalSpec[j]||"set" in this.originalSpec[j]){this.originalSpec[j].enumerable=true;if("kind" in this.originalSpec[j]){if(this.originalSpec[j].kind==="pseudo"){this.originalSpec[j].enumerable=false}else{i.push({fieldName:j,kind:this.originalSpec[j].kind})}delete this.originalSpec[j].kind}l[j]=this.originalSpec[j]}else{k[j]=this.originalSpec[j]}}}if(!("extend" in k)){k.extend=e.extend}this.originalSpec.__processedObject__={descriptor:l,proto:k,originalSpec:this.originalSpec||{},freezeFields:i};return this.originalSpec.__processedObject__},extend:function(){var j={};for(var l=0;l<arguments.length;l++){var m=arguments[l];for(var k in m){if(m.hasOwnProperty(k)){j[k]=m[k]}}}return j},mixInto:function(j,k){var i;for(i in k){if(!k.hasOwnProperty(i)){continue}j.prototype[i]=k[i]}}};g.exports=e},{}]},{},[1])(1)});
!function(b){if("object"==typeof exports){module.exports=b()}else{if("function"==typeof define&&define.amd){define(b)}else{var a;"undefined"!=typeof window?a=window:"undefined"!=typeof global?a=global:"undefined"!=typeof self&&(a=self),a.IMVVM=b()}}}(function(){var d,b,a;return(function c(f,k,h){function g(n,l){if(!k[n]){if(!f[n]){var i=typeof require=="function"&&require;if(!l&&i){return i(n,!0)}if(e){return e(n,!0)}throw new Error("Cannot find module '"+n+"'")}var m=k[n]={exports:{}};f[n][0].call(m.exports,function(o){var p=f[n][1][o];return g(p?p:o)},m,m.exports,c,f,k,h)}return k[n].exports}var e=typeof require=="function"&&require;for(var j=0;j<h.length;j++){g(h[j])}return g})({1:[function(h,g,f){var e=h("./src/imvvm.js");g.exports=e},{"./src/imvvm.js":3}],2:[function(h,g,f){var e=h("./utils");var i=e.extend;f.getInitialState=function(l,m,t,k){if(typeof t!=="function"){throw new TypeError()}var D,y={},r={},B,w={},v=[],E;var p;var j;var n;var A;var z;k===void (0)?true:k;var C=function(I,H){var G={};for(var F in I){if(I.hasOwnProperty(F)){if(Object.prototype.toString.call(I[F])==="[object Object]"){G[F]=I[F]}else{G[F]={};G[F][H]=I[F]}}}return G};var q=function(I,G){var K={},J,F;G=("dependsOn" in G)?G:{dependsOn:G};for(var H in G.dependsOn){if(G.dependsOn.hasOwnProperty(H)){F={};J=G.dependsOn[H].property.split(".");J.forEach(function(M,L){if(L===0){F=I[M]}else{F=F?F[M]:void (0)}});K[H]=F}}return K};var x=function(G,N,K,M){var H=false,J;N=N||{};K=K||{};if(G!==l){N[G]=new r[G](N[G],q(N,E[G]),K[G])}if(M){var L={};if(!!j){L=q(N,j);N=i(N,L);for(var I in j){if(j.hasOwnProperty(I)&&("onStateChange" in j[I])){var F={};F[I]=N[I];N=i(N,j[I].onStateChange(F))}}}N=new D(i(N,L),K,k);M.subscribers.forEach(function(O){if(O!==l){N[O]=new r[O](N[O],q(N,E[O]),K[O])}})}return N};var o=function(F,H,Q){var T={},N={},S=void (0),M,L,R;if((H===void (0)||H===null||Object.keys(H).length===0)){return}var K=!!H?Object.getPrototypeOf(H).constructor.classType==="DomainModel":false;if(K){T=i(H);N=H.previousState}else{if(F in w){M=Object.keys(H);L=M.length;R={};for(var J=0;J<L;J++){if(w[F][M[J]]){for(var G=0,I=w[F][M[J]].length;G<I;G++){R[w[F][M[J]][G].dataContext]=true}}}S={};S.name=F;S.subscribers=Object.keys(R);S=!!S.subscribers.length?S:void (0)}var P;var O;if(F!==l){T[F]=H;T=i(y.state,T);if(S&&S.subscribers){S.subscribers.forEach(function(Y){for(P=0;P<L;P++){if(w[F][M[P]]){var X=w[F][M[P]];var Z=X.length;for(O=0;O<Z;O++){var V=X[O].dataContext===l?j:E[X[O].dataContext].dependsOn;if(V[X[O].alias].onStateChange){var U={};U[X[O].alias]=T[F][M[P]];var W=V[X[O].alias].onStateChange.call(y.state[X[O].dataContext],U);if(Object.prototype.toString.call(W)==="[object Object]"){if(X[O].dataContext===l){T=i(T,W)}else{T[X[O].dataContext]=i(T[X[O].dataContext],W)}}}}}}})}}else{T=i(y.state,H)}N=y;T=x(F,T,y.state,S)}if(!!N){Object.freeze(N)}y=new D(T,N,k);Object.freeze(y);Object.freeze(y.state);t(y,F,Q);return y};D=m.call(this,o.bind(this,l));y=new D({},void (0),k,true);j=y.getDependencies?C(y.getDependencies(),"property"):void (0);if(j){v.push(l);for(p in j){if(j.hasOwnProperty(p)){B=j[p].property.split(".");n=B.length;A=n>1?B[0]:l;z=n>1?B[1]:B[0];w[A]=w[A]||{};w[A][z]=w[A][z]||[];if(w[A][z].indexOf(l)===-1){w[A][z].push({dataContext:l,alias:p})}}}}E=C(y.getDomainDataContext(),"viewModel");for(var s in E){if(E.hasOwnProperty(s)){r[s]=E[s].viewModel.call(this,o.bind(this,s));y[s]=new r[s]({},{},{},true);if(y[s].getDependencies){v.push(s);E[s].dependsOn=C(y[s].getDependencies(),"property");for(p in E[s].dependsOn){if(E[s].dependsOn.hasOwnProperty(p)){B=E[s].dependsOn[p].property.split(".");n=B.length;A=n>1?B[0]:l;z=n>1?B[1]:B[0];w[A]=w[A]||{};w[A][z]=w[A][z]||[];if(w[A][z].indexOf(s)===-1){w[A][z].push({dataContext:s,alias:p})}}}}}}v.forEach(function(F){if(F!==l){y[F]=new r[F](y[F],q(y,E[F]),{})}});var u=!!j?q(y,j):{};y=new D(i(y,u),void (0),k);Object.freeze(y.state);return Object.freeze(y)}},{"./utils":8}],3:[function(f,g,j){var k=f("./imvvmModel");var p=f("./imvvmViewModel");var i=f("./imvvmDomainModel");var r=f("./mixin");var q=f("./utils");var n=q.extend;var m=q.mixInto;var l=function(){};var h=function(){};var o=function(){};m(l,k.Mixin);m(h,p.Mixin);m(o,i.Mixin);var e={createClass:function(u,v,t){var y=function(){};y.prototype=new u();y.prototype.constructor=y;var x=y;var w=function(z){var A=new x();return A.construct.apply(w,arguments)};w.componentConstructor=y;y.ConvenienceConstructor=w;w.originalSpec=t;w.type=y;y.prototype.type=y;w.classType=v;y.prototype.classType=v;return w}};var s={createModel:e.createClass.bind(this,l,"Model"),createViewModel:e.createClass.bind(this,h,"ViewModel"),createDomainModel:e.createClass.bind(this,o,"DomainModel"),mixin:r};g.exports=s},{"./imvvmDomainModel":4,"./imvvmModel":5,"./imvvmViewModel":6,"./mixin":7,"./utils":8}],4:[function(j,h,f){var e=j("./utils");var k=e.extend;var g=e.getDescriptor;var i={Mixin:{construct:function(m){var n=g.call(this);n.proto.setState=m;var l=function(w,u,o,t){var q=n.freezeFields;var r=Object.create(n.proto,n.descriptor);Object.defineProperty(r,"state",{configurable:true,enumerable:false,writable:true,value:w});if(!!o&&!!u){Object.defineProperty(r,"previousState",{configurable:false,enumerable:false,writable:false,value:u})}u=u||{};if(t&&("getInitialState" in r)){w=k(w,r.getInitialState.call(r))}var v=Object.keys(w);for(var s=v.length-1;s>=0;s--){if(!(v[s] in r)){r[v[s]]=w[v[s]]}}Object.defineProperty(r,"state",{configurable:false,enumerable:false,writable:false,value:w});for(var p=q.length-1;p>=0;p--){Object.freeze(r[q[p].fieldName])}return r};return l}}};h.exports=i},{"./utils":8}],5:[function(i,h,f){var e=i("./utils");var k=e.extend;var g=e.getDescriptor;var j={Mixin:{construct:function(m){var n=g.call(this);var l=function(w,v,o){var p=n.freezeFields;var t=Object.create(n.proto,n.descriptor);var r=arguments.length;var u=typeof Array.prototype.slice.call(arguments,-1)[0]==="boolean";var s=false;if(r===0){w={};v={};o=false}else{if(r===1){if(u){o=w;w={};v={}}else{v={};o=false;s=true}}else{if(r===2){if(u){o=v;v={};s=true}else{o=false}}}}w=("state" in w)?w.state:w;v=("state" in v)?v.state:v;Object.defineProperty(t,"state",{configurable:true,enumerable:false,writable:true,value:w});if(s&&("getInitialState" in t)){w=k(w,t.getInitialState.call(t))}if(o){Object.defineProperty(t,"context",{configurable:true,enumerable:false,set:function(x){this.setState=function(y,z){return m.bind(x).call(x,k(this.state,y),this.state,z)}.bind(this);delete this.context}})}Object.defineProperty(t,"state",{configurable:false,enumerable:false,writable:false,value:w});for(var q=p.length-1;q>=0;q--){Object.freeze(t[p[q].fieldName])}if(!o){Object.freeze(t)}return t};return l}}};h.exports=j},{"./utils":8}],6:[function(j,i,g){var f=j("./utils");var k=f.extend;var h=f.getDescriptor;var e={Mixin:{construct:function(m){var n=h.call(this);n.proto.setState=m;var l=function(r,t,v,o){r=k(r,t);v=v||{};v=("state" in v)?v.state:v;var s=n.freezeFields;var p=Object.create(n.proto,n.descriptor);Object.defineProperty(p,"state",{configurable:true,enumerable:false,writable:true,value:r});if(o&&("getInitialState" in p)){r=k(r,p.getInitialState.call(p))}Object.defineProperty(p,"state",{configurable:false,enumerable:false,writable:false,value:r});for(var q=s.length-1;q>=0;q--){if(s[q].kind==="instance"&&("context" in p[s[q].fieldName])){p[s[q].fieldName].context=p}Object.freeze(p[s[q].fieldName])}for(var u in t){if(t.hasOwnProperty(u)&&u[0]!=="_"){Object.defineProperty(p,u,{configurable:false,enumerable:false,writable:false,value:t[u]})}}Object.freeze(r);return Object.freeze(p)};return l}}};i.exports=e},{"./utils":8}],7:[function(j,i,h){var f=j("./core");var e="__IMVVM__";var g={stateChangedHandler:function(k,l,m){this.setState({domainDataContext:k},function(){if(typeof m==="function"){if(this.state===null||!("domainDataContext" in this.state)){m(void (0))}else{if(l in this.state.domainDataContext){m(this.state.domainDataContext[l])}else{if(l===e){m(this.state.domainDataContext)}else{m(void (0))}}}}}.bind(this))},getInitialState:function(){var k=f.getInitialState(e,this.props.domainModel,this.stateChangedHandler,this.props.enableUndo);return{domainDataContext:k}}};i.exports=g},{"./core":2}],8:[function(h,g,f){var e={getDescriptor:function(){var l={};var k=this.prototype;var i=[];if("__processedObject__" in this.originalSpec){return this.originalSpec.__processedObject__}for(var j in this.originalSpec){if(this.originalSpec.hasOwnProperty(j)){if("get" in this.originalSpec[j]||"set" in this.originalSpec[j]){this.originalSpec[j].enumerable=true;if("kind" in this.originalSpec[j]){if(this.originalSpec[j].kind==="pseudo"){this.originalSpec[j].enumerable=false}else{i.push({fieldName:j,kind:this.originalSpec[j].kind})}delete this.originalSpec[j].kind}l[j]=this.originalSpec[j]}else{k[j]=this.originalSpec[j]}}}if(!("extend" in k)){k.extend=e.extend}this.originalSpec.__processedObject__={descriptor:l,proto:k,originalSpec:this.originalSpec||{},freezeFields:i};return this.originalSpec.__processedObject__},extend:function(){var j={};for(var l=0;l<arguments.length;l++){var m=arguments[l];for(var k in m){if(m.hasOwnProperty(k)){j[k]=m[k]}}}return j},mixInto:function(j,k){var i;for(i in k){if(!k.hasOwnProperty(i)){continue}j.prototype[i]=k[i]}}};g.exports=e},{}]},{},[1])(1)});
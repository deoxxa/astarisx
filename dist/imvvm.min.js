!function(b){if("object"==typeof exports){module.exports=b()}else{if("function"==typeof define&&define.amd){define(b)}else{var a;"undefined"!=typeof window?a=window:"undefined"!=typeof global?a=global:"undefined"!=typeof self&&(a=self),a.IMVVM=b()}}}(function(){var d,b,a;return(function c(f,k,h){function g(n,l){if(!k[n]){if(!f[n]){var i=typeof require=="function"&&require;if(!l&&i){return i(n,!0)}if(e){return e(n,!0)}throw new Error("Cannot find module '"+n+"'")}var m=k[n]={exports:{}};f[n][0].call(m.exports,function(o){var p=f[n][1][o];return g(p?p:o)},m,m.exports,c,f,k,h)}return k[n].exports}var e=typeof require=="function"&&require;for(var j=0;j<h.length;j++){g(h[j])}return g})({1:[function(h,g,f){var e=h("./src/imvvm.js");g.exports=e},{"./src/imvvm.js":4}],2:[function(g,f,e){(function(){var o=true;var h="";var l;function p(w,v){if("function"==typeof w){return p("*",w)}if("function"==typeof v){var t=new m(w);for(var u=1;u<arguments.length;++u){p.callbacks.push(t.middleware(arguments[u]))}}else{if("string"==typeof w){p.show(w,v)}else{p.start(w)}}}p.callbacks=[];p.base=function(t){if(0==arguments.length){return h}h=t};p.start=function(u){u=u||{};if(l){return}l=true;if(false===u.dispatch){o=false}if(false!==u.popstate){window.addEventListener("popstate",q,false)}if(false!==u.click){window.addEventListener("click",s,false)}if(!o){return}var t=location.pathname+location.search+location.hash;p.replace(t,null,true,o)};p.stop=function(){l=false;removeEventListener("click",s,false);removeEventListener("popstate",q,false)};p.show=function(w,v,u){var t=new r(w,v);if(false!==u){p.dispatch(t)}if(!t.unhandled){t.pushState()}return t};p.replace=function(w,v,x,u){var t=new r(w,v);t.init=x;if(null==u){u=true}if(u){p.dispatch(t)}t.save();return t};p.dispatch=function(t){var u=0;function v(){var w=p.callbacks[u++];if(!w){return j(t)}w(t,v)}v()};function j(t){var u=window.location.pathname+window.location.search;if(u==t.canonicalPath){return}p.stop();t.unhandled=true;window.location=t.canonicalPath}function r(w,u){if("/"==w[0]&&0!=w.indexOf(h)){w=h+w}var t=w.indexOf("?");this.canonicalPath=w;this.path=w.replace(h,"")||"/";this.title=document.title;this.state=u||{};this.state.path=w;this.querystring=~t?w.slice(t+1):"";this.pathname=~t?w.slice(0,t):w;this.params=[];this.hash="";if(!~this.path.indexOf("#")){return}var v=this.path.split("#");this.path=v[0];this.hash=v[1]||"";this.querystring=this.querystring.split("#")[0]}p.Context=r;r.prototype.pushState=function(){history.pushState(this.state,this.title,this.canonicalPath)};r.prototype.save=function(){history.replaceState(this.state,this.title,this.canonicalPath)};function m(u,t){t=t||{};this.path=u;this.method="GET";this.regexp=n(u,this.keys=[],t.sensitive,t.strict)}p.Route=m;m.prototype.middleware=function(u){var t=this;return function(v,w){if(t.match(v.path,v.params)){return u(v,w)}w()}};m.prototype.match=function(B,w){var A=this.keys,C=B.indexOf("?"),t=~C?B.slice(0,C):B,v=this.regexp.exec(t);if(!v){return false}for(var x=1,y=v.length;x<y;++x){var z=A[x-1];var u="string"==typeof v[x]?decodeURIComponent(v[x]):v[x];if(z){w[z.name]=undefined!==w[z.name]?w[z.name]:u}else{w.push(u)}}return true};function n(w,v,u,t){if(w instanceof RegExp){return w}if(w instanceof Array){w="("+w.join("|")+")"}w=w.concat(t?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(z,B,C,A,x,y){v.push({name:A,optional:!!y});B=B||"";return""+(y?"":B)+"(?:"+(y?B:"")+(C||"")+(x||(C&&"([^/.]+?)"||"([^/]+?)"))+")"+(y||"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)");return new RegExp("^"+w+"$",u?"":"i")}function q(u){if(u.state){var t=u.state.path;p.replace(t,u.state)}}function s(w){if(1!=i(w)){return}if(w.metaKey||w.ctrlKey||w.shiftKey){return}if(w.defaultPrevented){return}var t=w.target;while(t&&"A"!=t.nodeName){t=t.parentNode}if(!t||"A"!=t.nodeName){return}var u=t.getAttribute("href");if(t.pathname==location.pathname&&(t.hash||"#"==u)){return}if(t.target){return}if(!k(t.href)){return}var v=t.pathname+t.search+(t.hash||"");var x=v+t.hash;v=v.replace(h,"");if(h&&x==v){return}w.preventDefault();p.show(x)}function i(t){t=t||window.event;return null==t.which?t.button:t.which}function k(u){var t=location.protocol+"//"+location.hostname;if(location.port){t+=":"+location.port}return 0==u.indexOf(t)}if("undefined"==typeof f){window.page=p}else{f.exports=p}})()},{}],3:[function(h,g,f){var i=h("page");var e=h("./utils");var j=e.extend;f.getInitialState=function(o,p,A,n){if(typeof A!=="function"){throw new TypeError("stateChangedHandler must be a function!")}if(n===void (0)){n=false}var I,z={},v={},J,m={},E={},x,u={},s={},D,C,F,w,t,l=false,H=false,B={},G={},k,r=false,y=true;var q=function(M,R,T,Y){var aa={},W=void (0),O=void (0),U,P,N,L,Q,S=[],X,V,K,Z;if(R===void (0)){A(z);l=false;u={};s={};r=false;y=false;return}if(typeof T==="function"){Y=T;T={}}U=Object.keys(R);if(Object.getPrototypeOf(R).constructor.classType==="DomainViewModel"){aa=j(R);W=R.previousState;O=T;for(L in J){aa[L]=new v[L](aa[L])}for(L in J){if(J.hasOwnProperty(L)){for(Q in m[L]){if(m[L].hasOwnProperty(Q)){aa[L].state[m[L][Q]]=(Q in J)?j(aa[Q].state):aa[Q]}}}}if(typeof Y==="function"){z=new I(aa,W,O,n,H);Y(z);return}}else{if(!!U.length){if(M===o){aa=j(R)}else{aa[M]=j(R)}}u=j(aa,u,T);transientStateKeys=Object.keys(u);if(transientStateKeys.length===0){return}N=transientStateKeys.length-1;for(P=N;P>=0;P--){if(transientStateKeys[P] in J){aa[transientStateKeys[P]]=j(z[transientStateKeys[P]],u[transientStateKeys[P]]);aa[transientStateKeys[P]]=new v[transientStateKeys[P]](aa[transientStateKeys[P]])}else{aa[transientStateKeys[P]]=u[transientStateKeys[P]]}}s=j(s,aa);aa=j(z,s);u={};for(P=N;P>=0;P--){if(transientStateKeys[P] in E){for(V in E[transientStateKeys[P]]){if(E[transientStateKeys[P]].hasOwnProperty(V)){if(U.indexOf(V)!==-1){K=E[transientStateKeys[P]][V];for(Z in K){if(K.hasOwnProperty(Z)){if(Z in m){for(L in m[Z]){if(m[Z].hasOwnProperty(L)){aa[Z].state[m[Z][L]]=(L in J)?j(aa[L].state):aa[L]}if(L in m){for(dataContext2 in m[L]){if(m[L].hasOwnProperty(dataContext2)){aa[L].state[m[L][dataContext2]]=(dataContext2 in J)?j(aa[dataContext2].state):aa[dataContext2]}}}}}u=j(u,K[Z].call(z[Z],aa[transientStateKeys[P]][V],z[transientStateKeys[P]][V],V,transientStateKeys[P],aa.path,z.path))}}}}}}}if(!!Object.keys(u).length){q(void (0),{},u);return}S=Object.keys(s);X=S.length-1;for(P=X;P>=0;P--){if(M===o){if(S[P] in m[o]){for(L in m[o][S[P]]){if(m[o][S[P]].hasOwnProperty(L)){aa[L].state[m[o][S[P]][L]]=aa[S[P]]}if(L in m){for(dataContext2 in m[L]){if(m[L].hasOwnProperty(dataContext2)){aa[L].state[m[L][dataContext2]]=(dataContext2 in J)?j(aa[dataContext2].state):aa[dataContext2]}}}}}}else{if(S[P] in m){for(L in m[S[P]]){if(m[S[P]].hasOwnProperty(L)){aa[S[P]].state[m[S[P]][L]]=aa[L]}if(L in m){for(dataContext2 in m[L]){if(m[L].hasOwnProperty(dataContext2)){aa[L].state[m[L][dataContext2]]=aa[dataContext2]}}}}}}}if(z.canRevert&&l){W=z.previousState}else{W=z}}if(!!W){Object.freeze(W)}z=new I(aa,W,O,n,H);Object.freeze(z);Object.freeze(z.state);if(typeof Y==="function"){l=true;Y(z);return}A(z);l=false;u={};s={};if(H){if(("path" in z)&&!r){y=true;if(aa.enableUndo||z.canRevert||M===o){i.replace(z.path)}else{i(z.path)}}r=false}};I=p.call(this,q.bind(this,o));z=new I(void (0),void (0),void (0),n,H);z.state=z.state||{};J=z.constructor.originalSpec.getDomainDataContext();delete z.constructor.originalSpec.getDomainDataContext;for(x in J){if(J.hasOwnProperty(x)){v[x]=J[x].call(this,q.bind(this,x));z.state[x]=new v[x](z.state[x],true)}}for(x in J){if(J.hasOwnProperty(x)){if("getWatchedState" in z[x].constructor.originalSpec){D=z[x].constructor.originalSpec.getWatchedState();for(C in D){if(D.hasOwnProperty(C)){if(C in J||C in z.state){if("alias" in D[C]){if(!(x in m)){m[x]={}}m[x][C]=D[C].alias;if(!(C in J)){if(!(o in m)){m[o]={}}if(!(x in m[o])){m[o][C]={}}m[o][C][x]=D[C].alias}}for(F in D[C].fields){if(D[C].fields.hasOwnProperty(F)){if(C in J){w={};if(!(C in E)){E[C]={}}w[F]={};w[F][x]=D[C].fields[F];E[C]=w}}}}}}}}}for(x in J){if(J.hasOwnProperty(x)){for(t in m[x]){if(m[x].hasOwnProperty(t)){z[x].state[m[x][t]]=z[t]}}}}for(x in J){if(J.hasOwnProperty(x)){z.state[x]=new v[x](z.state[x]);if("getRoutes" in z[x].constructor.originalSpec){H=true;B=z[x].constructor.originalSpec.getRoutes();for(k in B){if(B.hasOwnProperty(k)){G[B[k].path]=B[k].handler;i(B[k].path,function(N,M,K,L){r=true;if(!y){G[M].call(z[N],L.params,L.path,K,L)}y=false}.bind(this,x,B[k].path,k))}}delete z[x].constructor.originalSpec.getRoutes}}}if("getRoutes" in z.constructor.originalSpec){H=true;B=z.constructor.originalSpec.getRoutes();for(k in B){if(B.hasOwnProperty(k)){G[B[k].path]=B[k].handler;i(B[k].path,function(M,K,L){r=true;G[M].call(z,L.params,L.path,K,L);y=false}.bind(this,B[k].path,k))}}delete z.constructor.originalSpec.getRoutes}z=new I(z,void (0),void (0),n,H);if(H){i.replace(z.path);y=true;i.start({click:false,dispatch:false});r=false}Object.freeze(z.state);Object.freeze(z);return z}},{"./utils":9,page:2}],4:[function(f,g,j){var k=f("./imvvmModel");var r=f("./imvvmViewModel");var i=f("./imvvmDomainViewModel");var s=f("./mixin");var p=f("page");var q=f("./utils");var o=q.extend;var m=q.mixInto;var l=function(){};var h=function(){};var n=function(){};m(l,k.Mixin);m(h,r.Mixin);m(n,i.Mixin);var e={createClass:function(v,w,u){var z=function(){};z.prototype=new v();z.prototype.constructor=z;var y=z;var x=function(A){var B=new y();return B.construct.apply(x,arguments)};x.componentConstructor=z;z.ConvenienceConstructor=x;x.originalSpec=u;x.type=z;z.prototype.type=z;x.classType=w;z.prototype.classType=w;x.getDescriptor=function(){var F={},E=this.prototype,C={},A=[],B={},D;if("__processedSpec__" in this.originalSpec){return this.originalSpec.__processedSpec__}for(D in this.originalSpec){if(this.originalSpec.hasOwnProperty(D)){if("get" in this.originalSpec[D]||"set" in this.originalSpec[D]){this.originalSpec[D].enumerable=true;if("viewModel" in this.originalSpec[D]){C[D]=this.originalSpec[D].viewModel;delete this.originalSpec[D].viewModel;delete this.originalSpec[D].set}else{if("aliasFor" in this.originalSpec[D]){B[this.originalSpec[D].aliasFor]=D;delete this.originalSpec[D].aliasFor}if("kind" in this.originalSpec[D]){if(this.originalSpec[D].kind==="pseudo"){this.originalSpec[D].enumerable=false}else{if(this.originalSpec[D].kind==="instance"||this.originalSpec[D].kind==="array"){A.push({fieldName:D,kind:this.originalSpec[D].kind})}else{throw new TypeError('"'+this.originalSpec[D].kind+'" is not a valid "kind" value. Valid values are "pseudo","instance" and "array". Please review field "'+D+'".')}}delete this.originalSpec[D].kind}}F[D]=this.originalSpec[D]}else{if(D!=="getInitialState"&&D!=="getWatchedState"&&D!=="getRoutes"){E[D]=this.originalSpec[D]}}}}if(!!Object.keys(C).length){this.originalSpec.getDomainDataContext=function(){return C}}this.originalSpec.__processedSpec__={descriptor:F,proto:E,originalSpec:this.originalSpec||{},freezeFields:A,aliases:B};return this.originalSpec.__processedSpec__};return x}};var t={createModel:e.createClass.bind(this,l,"Model"),createViewModel:e.createClass.bind(this,h,"ViewModel"),createDomainViewModel:e.createClass.bind(this,n,"DomainViewModel"),mixin:s,extend:o,page:p};g.exports=t},{"./imvvmDomainViewModel":5,"./imvvmModel":6,"./imvvmViewModel":7,"./mixin":8,"./utils":9,page:2}],5:[function(i,h,g){var f=i("./utils");var j=f.extend;var e={Mixin:{construct:function(l){var m=this.getDescriptor();m.proto.setState=l;m.proto.revert=function(){this.setState(this.previousState,!!this.previousState?this:void (0))};m.proto.advance=function(){if(this.canAdvance){this.setState(this.nextState,this.nextState.nextState)}};var k=function(u,t,r,o,v){var p=m.freezeFields,q=Object.create(m.proto,m.descriptor),s;var n=!!u?u.enableUndo:false;if(o||v||n){if(!!t){if(!n&&v&&t.path!==u.path){Object.defineProperty(q,"canRevert",{configurable:false,enumerable:false,writable:false,value:false})}else{Object.defineProperty(q,"previousState",{configurable:false,enumerable:false,writable:false,value:t});Object.defineProperty(q,"canRevert",{configurable:false,enumerable:false,writable:false,value:true})}}else{Object.defineProperty(q,"canRevert",{configurable:false,enumerable:false,writable:false,value:false})}if(!!r&&"state" in r){Object.defineProperty(q,"nextState",{configurable:false,enumerable:false,writable:false,value:r});Object.defineProperty(q,"canAdvance",{configurable:false,enumerable:false,writable:false,value:true})}else{Object.defineProperty(q,"canAdvance",{configurable:false,enumerable:false,writable:false,value:false})}}if(u===void (0)){u=("getInitialState" in m.originalSpec)?m.originalSpec.getInitialState.call(q):{}}else{if("state" in u){delete u.state;Object.defineProperty(q,"state",{configurable:true,enumerable:false,writable:true,value:u});u=j(u,q)}}for(s=p.length-1;s>=0;s--){if(p[s].kind==="array"){u[p[s].fieldName]=u[p[s].fieldName]||[];Object.freeze(u[p[s].fieldName])}else{throw new TypeError('kind:"instance" can only be specified in a ViewModel.')}}Object.defineProperty(q,"state",{configurable:false,enumerable:false,writable:false,value:u});return q};return k}}};h.exports=e},{"./utils":9}],6:[function(h,g,f){var e=h("./utils");var j=e.extend;var i={Mixin:{construct:function(l){var m=this.getDescriptor();var k=function(r,p,n){var s=m.freezeFields,q,o=Object.create(m.proto,m.descriptor);if(r===void (0)){n=true}else{if(typeof r==="boolean"){n=r;r=void (0)}else{if(typeof p==="boolean"){n=p;p=void (0)}}}r=j(r,p);Object.defineProperty(o,"state",{configurable:true,enumerable:false,writable:true,value:r});r=j(r,o);if(n){for(var t in m.aliases){if(m.aliases.hasOwnProperty(t)&&t in r){r[m.aliases[t]]=r[t];delete r[t]}}Object.defineProperty(o,"state",{configurable:true,enumerable:false,writable:true,value:r});r=j(r,o);if("getInitialState" in m.originalSpec){r=j(r,m.originalSpec.getInitialState.call(o))}}for(q=s.length-1;q>=0;q--){if(s[q].kind==="array"){r[s[q].fieldName]=r[s[q].fieldName]||[];Object.freeze(r[s[q].fieldName])}else{throw new TypeError('kind:"instance" can only be specified in a ViewModel.')}}Object.defineProperty(o,"state",{configurable:false,enumerable:false,writable:false,value:r});o.__stateChangedHandler=(function(){return l})();return Object.freeze(o)};return k}}};g.exports=i},{"./utils":9}],7:[function(i,h,g){var f=i("./utils");var j=f.extend;var e={Mixin:{construct:function(l){var m=this.getDescriptor(this);m.proto.setState=l;var k=function(r,n){r=r||{};r=("state" in r?r.state:r);var s=m.freezeFields,q,p=Object.create(m.proto,m.descriptor),t,o;Object.defineProperty(p,"state",{configurable:true,enumerable:false,writable:true,value:r});if(n){r=("getInitialState" in m.originalSpec)?j(r,m.originalSpec.getInitialState.call(p)):r;Object.defineProperty(p,"state",{configurable:true,enumerable:false,writable:true,value:r})}for(q=s.length-1;q>=0;q--){if(s[q].kind==="instance"){if(p[s[q].fieldName]){t=p[s[q].fieldName].constructor.originalSpec.__processedSpec__;o=Object.create(t.proto,t.descriptor);o.__stateChangedHandler=(function(u){return p[u].__stateChangedHandler})(s[q].fieldName);Object.defineProperty(o,"state",{configurable:true,enumerable:false,writable:true,value:p[s[q].fieldName].state});o.__proto__.setState=function(u,v){this.__stateChangedHandler.call(p,j(this.state,u),v)};Object.freeze(p[s[q].fieldName])}}else{r[s[q].fieldName]=r[s[q].fieldName]||[];Object.freeze(r[s[q].fieldName])}}Object.defineProperty(p,"state",{configurable:false,enumerable:false,writable:false,value:r});return Object.freeze(p)};return k}}};h.exports=e},{"./utils":9}],8:[function(j,i,h){var f=j("./core");var e="__IMVVM__";var g={stateChangedHandler:function(k){this.setState({domainDataContext:k})},getInitialState:function(){var k=f.getInitialState(e,this.props.domainModel,this.stateChangedHandler,this.props.enableUndo);return{domainDataContext:k}}};i.exports=g},{"./core":3}],9:[function(h,g,f){var e={extend:function(){var j={};for(var l=0;l<arguments.length;l++){var m=arguments[l];for(var k in m){if(m.hasOwnProperty(k)){j[k]=m[k]}}}return j},mixInto:function(j,k){var i;for(i in k){if(!k.hasOwnProperty(i)){continue}j.prototype[i]=k[i]}}};g.exports=e},{}]},{},[1])(1)});
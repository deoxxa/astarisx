!function(b){if("object"==typeof exports){module.exports=b()}else{if("function"==typeof define&&define.amd){define(b)}else{var a;"undefined"!=typeof window?a=window:"undefined"!=typeof global?a=global:"undefined"!=typeof self&&(a=self),a.IMVVM=b()}}}(function(){var d,b,a;return(function c(f,k,h){function g(n,l){if(!k[n]){if(!f[n]){var i=typeof require=="function"&&require;if(!l&&i){return i(n,!0)}if(e){return e(n,!0)}throw new Error("Cannot find module '"+n+"'")}var m=k[n]={exports:{}};f[n][0].call(m.exports,function(o){var p=f[n][1][o];return g(p?p:o)},m,m.exports,c,f,k,h)}return k[n].exports}var e=typeof require=="function"&&require;for(var j=0;j<h.length;j++){g(h[j])}return g})({1:[function(h,g,f){var e=h("./src/imvvm.js");g.exports=e},{"./src/imvvm.js":3}],2:[function(h,g,f){var e=h("./utils");var i=e.extend;f.getInitialState=function(k,p,u,y){if(typeof u!=="function"){throw new TypeError()}var x,w={},j={},v,n={},q,t=false;y===void (0)?false:y;var o=function(C,G,E){var H=false,F,B;G=G||{};if(C===void (0)){B=true;C={}}var D=function(J){var L={},K,I;if("dependsOn" in J){J.dependsOn.forEach(function(M){I={};K=M.property.split(".");K.forEach(function(O,N){if(N===0){I=C[O]}else{I=I?I[O]:void (0)}});if("alias" in M){L[M.alias]=I}else{L[K.join("$")]=I}})}return L};for(var A in q){if(q.hasOwnProperty(A)){F=D(q[A]);if(B){C[A]=new j[A](C[A],F,G[A]).getInitialState()}else{C[A]=new j[A](C[A],F,G[A])}if(E){if(H&&E.subscribers.indexOf(A)!==-1){F=D(q[E.name]);C[E.name]=new j[E.name](C[E.name],F,G[E.name])}H=H?H:A===E.name}}}return C};var m=function(C,E,M,I){var P={},L={},O=void (0),J,H,N,K=false;I===void (0)?false:I;if(!I&&(E===void (0)||E===null||Object.keys(E).length===0)){return}var G=!!E?Object.getPrototypeOf(E).constructor.classType==="DomainModel":false;if(G){P=i(E);L=E.previousState;K=true}else{if(C in n){J=Object.keys(E);H=J.length;N={};for(var F=0;F<H;F++){if(n[C][J[F]]){N[n[C][J[F]]]=true}}O={};O.name=C;O.subscribers=Object.keys(N);O=!!O.subscribers.length?O:void (0)}if(C!==k){P[C]=E;P=i(w.state,P)}else{if(I){P=i(o(),E)}else{P=i(w.state,E)}}L=t?w.previousState:w;P=o(P,w.state,O)}L=L||{};Object.freeze(L);w=new x(P,L,y);if(!!w.getValidState&&!K&&!t){var B=w.getValidState(w.state,w.previousState);var A=Object.keys(B);for(var D=A.length-1;D>=0;D--){if(Object.prototype.toString.call(B[A[D]])!=="[object Object]"&&Object.prototype.toString.call(B[A[D]])!=="[object Array]"&&B[A[D]]!==w.state[A[D]]){t=true;w.setState(i(w.state,B));t=false;break}}}if(!t){Object.freeze(w);Object.freeze(w.state);u(w,C,M);return w}};x=p.call(this,m.bind(this,k));var z=new x({},{},y);q=z.getDataContexts();for(var l in q){if(q.hasOwnProperty(l)){j[l]=q[l].viewModel.call(this,m.bind(this,l));if("dependsOn" in q[l]){for(var r=0,s=q[l].dependsOn.length;r<s;r++){v=q[l].dependsOn[r].property.split(".");if(v.length>1){n[v[0]]=n[v[0]]||{};n[v[0]][v[1]]=n[v[0]][v[1]]||[];if(n[v[0]][v[1]].indexOf(l)===-1){n[v[0]][v[1]].push(l)}}}}}}return z.getInitialState()}},{"./utils":8}],3:[function(f,g,j){var k=f("./imvvmModel");var p=f("./imvvmViewModel");var i=f("./imvvmDomainModel");var r=f("./mixin");var q=f("./utils");var n=q.extend;var m=q.mixInto;var l=function(){};var h=function(){};var o=function(){};m(l,k.Mixin);m(h,p.Mixin);m(o,i.Mixin);var e={createClass:function(u,v,t){var y=function(){};y.prototype=new u();y.prototype.constructor=y;var x=y;var w=function(z){var A=new x();return A.construct.apply(w,arguments)};w.componentConstructor=y;y.ConvenienceConstructor=w;w.originalSpec=t;w.type=y;y.prototype.type=y;w.classType=v;y.prototype.classType=v;return w}};var s={createModel:e.createClass.bind(this,l,"Model"),createViewModel:e.createClass.bind(this,h,"ViewModel"),createDomainModel:e.createClass.bind(this,o,"DomainModel"),mixin:r};g.exports=s},{"./imvvmDomainModel":4,"./imvvmModel":5,"./imvvmViewModel":6,"./mixin":7,"./utils":8}],4:[function(j,h,f){var e=j("./utils");var k=e.extend;var g=e.getDescriptor;var i={Mixin:{construct:function(n){var o=g.call(this);o.proto.setState=n;var m=function(p,q){return o.proto.setState(p,q,true)};var l=function(t,v,p){var w;var u;t=t||{};v=v||{};if(!("getInitialState" in o.proto)){o.proto.getInitialState=function(){return m()}}else{w=o.proto.getInitialState;o.proto.getInitialState=function(){return m(w.call(this))}}var r=Object.create(o.proto,o.descriptor);Object.defineProperty(r,"state",{configurable:true,enumerable:false,writable:true,value:t});t=k(t,r);if(!!o.originalSpec.getInitialCalculatedState){for(var s=o.calculatedFields.length-1;s>=0;s--){if(!(o.calculatedFields[s] in t)||t[o.calculatedFields[s]]===void (0)){u={};u[o.calculatedFields[s]]=o.originalSpec.getInitialCalculatedState.call(r,t,v)[o.calculatedFields[s]];if(u[o.calculatedFields[s]]!==void (0)){t=k(t,u)}}}}if(!p&&!!Object.keys(v).length){Object.defineProperty(t,"previousState",{configurable:false,enumerable:false,writable:false,value:v})}Object.defineProperty(t,"state",{configurable:false,enumerable:false,writable:false,value:k(t)});for(var q in o.descriptor){if(o.descriptor.hasOwnProperty(q)){Object.defineProperty(t,q,o.descriptor[q])}}t.__proto__=r.__proto__;return t};return l}}};h.exports=i},{"./utils":8}],5:[function(i,h,f){var e=i("./utils");var k=e.extend;var g=e.getDescriptor;var j={Mixin:{construct:function(m){var n=g.call(this);var l=function(s,u,o){var p=Object.create(n.proto,n.descriptor);var v=arguments.length;var r=typeof Array.prototype.slice.call(arguments,-1)[0]==="boolean";var t;if(v===0){s={};u={};o=true}else{if(v===1){if(r){o=s;s={};u={}}else{u=s;o=true}}else{if(v===2){if(r){o=u;u=s}else{o=true}}}}s=("state" in s)?s.state:s;u=("state" in u)?u.state:u;Object.defineProperty(p,"state",{configurable:true,enumerable:false,writable:true,value:s});s=k(s,p);if(!!n.originalSpec.getInitialCalculatedState){for(var q=n.calculatedFields.length-1;q>=0;q--){if(!(n.calculatedFields[q] in s)||s[n.calculatedFields[q]]===void (0)){t={};t[n.calculatedFields[q]]=n.originalSpec.getInitialCalculatedState.call(p,s,u)[n.calculatedFields[q]];if(t[n.calculatedFields[q]]!==void (0)){s=k(s,t)}}}}if(n.originalSpec.getValidState){s=k(s,n.originalSpec.getValidState.call(p,s,u))}if(o){Object.defineProperty(p,"context",{configurable:true,enumerable:true,set:function(w){this.setState=function(x,y){return m.bind(w).call(w,k(this.state,x),this.state,y)}.bind(this);delete this.context}})}Object.defineProperty(p,"state",{configurable:false,enumerable:false,writable:false,value:s});Object.keys(p).forEach(function(w){if(Object.prototype.toString.call(this[w])==="[object Object]"||Object.prototype.toString.call(this[w])==="[object Array]"){Object.freeze(this[w])}}.bind(p));if(!o){Object.freeze(p)}return p};return l}}};h.exports=j},{"./utils":8}],6:[function(j,i,g){var f=j("./utils");var k=f.extend;var h=f.getDescriptor;var e={Mixin:{construct:function(m){var n=h.call(this);n.proto.setState=m;var l=function(q,r,u){var v;var t;q=k(q,r);u=u||{};u=("state" in u)?u.state:u;if(!("getInitialState" in n.proto)){n.proto.getInitialState=function(){return l()}}else{v=n.proto.getInitialState;n.proto.getInitialState=function(){return l(v.call(this))}}var o=Object.create(n.proto,n.descriptor);Object.defineProperty(o,"state",{configurable:true,enumerable:false,writable:true,value:q});q=k(q,o);if(!!n.originalSpec.getInitialCalculatedState){for(var p=n.calculatedFields.length-1;p>=0;p--){if(!(n.calculatedFields[p] in q)||q[n.calculatedFields[p]]===void (0)){t={};t[n.calculatedFields[p]]=n.originalSpec.getInitialCalculatedState.call(o,q,u)[n.calculatedFields[p]];if(t[n.calculatedFields[p]]!==void (0)){q=k(q,t)}}}}if(n.originalSpec.getValidState){q=k(q,n.originalSpec.getValidState.call(o,q,u))}Object.defineProperty(o,"state",{configurable:false,enumerable:false,writable:false,value:q});Object.keys(o).forEach(function(w){if(Object.prototype.toString.call(this[w])==="[object Object]"&&("context" in this[w])){this[w].context=this;Object.freeze(this[w])}else{if(Object.prototype.toString.call(this[w])==="[object Array]"){Object.freeze(this[w])}}}.bind(o));for(var s in r){if(r.hasOwnProperty(s)&&s[0]!=="_"){Object.defineProperty(o,s,{configurable:false,enumerable:false,writable:false,value:r[s]})}}Object.freeze(q);return Object.freeze(o)};return l}}};i.exports=e},{"./utils":8}],7:[function(j,i,h){var f=j("./core");var e="__IMVVM__";var g={stateChangedHandler:function(k,l,m){this.setState({applicationDataContext:k},function(){if(typeof m==="function"){if(this.state===null||!("applicationDataContext" in this.state)){m(void (0))}else{if(l in this.state.applicationDataContext){m(this.state.applicationDataContext[l])}else{if(l===e){m(this.state.applicationDataContext)}else{m(void (0))}}}}}.bind(this))},getInitialState:function(){var k=f.getInitialState(e,this.props.domainModel,this.stateChangedHandler,this.props.disableUndo);return{applicationDataContext:k}}};i.exports=g},{"./core":2}],8:[function(h,g,f){var e={getDescriptor:function(){var l={};var k=this.prototype;var i=[];for(var j in this.originalSpec){if(this.originalSpec.hasOwnProperty(j)){if("get" in this.originalSpec[j]||"set" in this.originalSpec[j]){if("calculated" in this.originalSpec[j]){l[j]=e.extend(this.originalSpec[j]);l[j].enumerable=!this.originalSpec[j].calculated;delete l[j].calculated;i.push(j)}else{if(!("enumerable" in this.originalSpec[j])){if("pseudo" in this.originalSpec[j]){this.originalSpec[j].enumerable=!this.originalSpec[j].pseudo;delete this.originalSpec[j].pseudo}else{this.originalSpec[j].enumerable=true}l[j]=this.originalSpec[j]}else{l[j]=this.originalSpec[j]}}}else{k[j]=this.originalSpec[j]}}}if(!("extend" in k)){k.extend=e.extend}return{descriptor:l,proto:k,originalSpec:this.originalSpec||{},calculatedFields:i}},extend:function(){var j={};for(var l=0;l<arguments.length;l++){var m=arguments[l];for(var k in m){if(m.hasOwnProperty(k)){j[k]=m[k]}}}return j},mixInto:function(j,k){var i;for(i in k){if(!k.hasOwnProperty(i)){continue}j.prototype[i]=k[i]}}};g.exports=e},{}]},{},[1])(1)});
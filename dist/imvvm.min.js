!function(b){if("object"==typeof exports){module.exports=b()}else{if("function"==typeof define&&define.amd){define(b)}else{var a;"undefined"!=typeof window?a=window:"undefined"!=typeof global?a=global:"undefined"!=typeof self&&(a=self),a.IMVVM=b()}}}(function(){var d,b,a;return(function c(f,k,h){function g(n,l){if(!k[n]){if(!f[n]){var i=typeof require=="function"&&require;if(!l&&i){return i(n,!0)}if(e){return e(n,!0)}throw new Error("Cannot find module '"+n+"'")}var m=k[n]={exports:{}};f[n][0].call(m.exports,function(o){var p=f[n][1][o];return g(p?p:o)},m,m.exports,c,f,k,h)}return k[n].exports}var e=typeof require=="function"&&require;for(var j=0;j<h.length;j++){g(h[j])}return g})({1:[function(h,g,f){var e=h("./src/imvvm.js");g.exports=e},{"./src/imvvm.js":3}],2:[function(h,g,f){var e=h("./utils");var i=e.extend;f.getInitialState=function(j,k,q,y){if(typeof q!=="function"){throw new TypeError()}var z,u={},n={},v,s={},A,p=false;y===void (0)?false:y;var m=function(D,C){var F={},E,B;C.dependsOn.forEach(function(G){B={};E=G.property.split(".");E.forEach(function(I,H){if(H===0){B=D[I]}else{B=B?B[I]:void (0)}});if("alias" in G){F[G.alias]=B}else{F[E.join("$")]=B}});return F};var t=function(D,F,J,H,I){var E=false,G;J=J||{};H=H||{};var B=function(L,M){var O={},N,K;if("dependsOn" in L){L.dependsOn.forEach(function(P){K={};N=P.property.split(".");if(M===true){N.forEach(function(R,Q){if(Q===0){K=J[R]}else{K=K?K[R]:void (0)}});if("alias" in P){O[P.alias]=K}else{O[N.join("$")]=K}}else{if(M===N[0]){N.forEach(function(R,Q){if(Q===0){K=J[R]}else{K=K?K[R]:void (0)}});if("alias" in P){O[P.alias]=K}else{O[N.join("$")]=K}}}})}return O};if(F){for(var C in A){if(A.hasOwnProperty(C)){G=B(A[C],F);J[C]=new n[C](J[C],G,H[C]);if(!!J[C].getInitialState){J[C]=new n[C](J[C].getInitialState(),G,J[C])}}if(I){if(E&&I.subscribers.indexOf(C)!==-1){G=B(A[I.name]);J[I.name]=new n[I.name](J[I.name],G,H[I.name])}E=E?E:C===I.name}}}else{G=B(A[D],true);J[D]=new n[D](J[D],G,H[D]);if(I){I.subscribers.forEach(function(K){G=i(J[K].dependencies,B(A[K],D));J[K]=new n[K](J[K],G,H[K])})}}return J};var l=function(D,F,N,J){var Q={},M={},P=void (0),K,I,O,L=false;J===void (0)?false:J;if(!J&&(F===void (0)||F===null||Object.keys(F).length===0)){return}var H=!!F?Object.getPrototypeOf(F).constructor.classType==="DomainModel":false;if(H){Q=i(F);M=F.previousState;L=true}else{if(D in s){K=Object.keys(F);I=K.length;O={};for(var G=0;G<I;G++){if(s[D][K[G]]){O[s[D][K[G]]]=true}}P={};P.name=D;P.subscribers=Object.keys(O);P=!!P.subscribers.length?P:void (0)}if(D!==j){Q[D]=F;Q=i(u.state,Q)}else{if(J){Q=t(D,true,i(u.state,F))}else{Q=i(u.state,F)}}M=p?u.previousState:u;Q=t(D,D===j,Q,u.state,P)}if(!!M){Object.freeze(M)}u=new z(Q,M,y);if(!!u.getValidState&&!L&&!p){var C=u.getValidState(u.state,u.previousState);var B=Object.keys(C);for(var E=B.length-1;E>=0;E--){if(Object.prototype.toString.call(C[B[E]])!=="[object Object]"&&Object.prototype.toString.call(C[B[E]])!=="[object Array]"&&C[B[E]]!==u.state[B[E]]){p=true;u.setState(i(u.state,C));p=false;break}}}if(!p){Object.freeze(u);Object.freeze(u.state);q(u,D,N);return u}};var r=[];z=k.call(this,l.bind(this,j));u=new z({},void (0),y,true);A=u.getDomainDataContext();for(var o in A){if(A.hasOwnProperty(o)){n[o]=A[o].viewModel.call(this,l.bind(this,o));u[o]=new n[o]({},{},{},true);if("dependsOn" in A[o]){r.push(o);for(var w=0,x=A[o].dependsOn.length;w<x;w++){v=A[o].dependsOn[w].property.split(".");if(v.length>1){s[v[0]]=s[v[0]]||{};s[v[0]][v[1]]=s[v[0]][v[1]]||[];if(s[v[0]][v[1]].indexOf(o)===-1){s[v[0]][v[1]].push(o)}}}}}}r.forEach(function(B){var C=m(u,A[B]);u[B]=new n[B](u[B],C,{},true)});u=new z(i(u),void (0),y);return Object.freeze(u)}},{"./utils":8}],3:[function(f,g,j){var k=f("./imvvmModel");var p=f("./imvvmViewModel");var i=f("./imvvmDomainModel");var r=f("./mixin");var q=f("./utils");var n=q.extend;var m=q.mixInto;var l=function(){};var h=function(){};var o=function(){};m(l,k.Mixin);m(h,p.Mixin);m(o,i.Mixin);var e={createClass:function(u,v,t){var y=function(){};y.prototype=new u();y.prototype.constructor=y;var x=y;var w=function(z){var A=new x();return A.construct.apply(w,arguments)};w.componentConstructor=y;y.ConvenienceConstructor=w;w.originalSpec=t;w.type=y;y.prototype.type=y;w.classType=v;y.prototype.classType=v;return w}};var s={createModel:e.createClass.bind(this,l,"Model"),createViewModel:e.createClass.bind(this,h,"ViewModel"),createDomainModel:e.createClass.bind(this,o,"DomainModel"),mixin:r};g.exports=s},{"./imvvmDomainModel":4,"./imvvmModel":5,"./imvvmViewModel":6,"./mixin":7,"./utils":8}],4:[function(j,h,f){var e=j("./utils");var k=e.extend;var g=e.getDescriptor;var i={Mixin:{construct:function(m){var n=g.call(this);n.proto.setState=m;var l=function(s,u,p,o){var q=Object.create(n.proto,n.descriptor);s=s||{};if(!p&&!!u){Object.defineProperty(q,"previousState",{configurable:false,enumerable:false,writable:false,value:u})}u=u||{};if(o&&("getInitialState" in n.proto)){Object.defineProperty(q,"state",{configurable:true,enumerable:false,writable:true,value:s});s=k(s,n.proto.getInitialState.call(q))}var t=Object.keys(s);for(var r=t.length-1;r>=0;r--){if(!(t[r] in q)){q[t[r]]=s[t[r]]}}Object.defineProperty(q,"state",{configurable:false,enumerable:false,writable:false,value:s});return q};return l}}};h.exports=i},{"./utils":8}],5:[function(i,h,f){var e=i("./utils");var k=e.extend;var g=e.getDescriptor;var j={Mixin:{construct:function(m){var n=g.call(this);var l=function(s,u,p){var q=Object.create(n.proto,n.descriptor);var v=arguments.length;var r=typeof Array.prototype.slice.call(arguments,-1)[0]==="boolean";var t;var o=false;if(v===0){s={};u={};p=false}else{if(v===1){if(r){p=s;s={};u={}}else{u={};p=false;o=true}}else{if(v===2){if(r){p=u;u={};o=true}else{p=false}}}}s=("state" in s)?s.state:s;u=("state" in u)?u.state:u;Object.defineProperty(q,"state",{configurable:true,enumerable:false,writable:true,value:s});if(o&&!!n.originalSpec.getInitialState){s=k(s,n.originalSpec.getInitialState.call(q))}if(p){Object.defineProperty(q,"context",{configurable:true,enumerable:true,set:function(w){this.setState=function(x,y){return m.bind(w).call(w,k(this.state,x),this.state,y)}.bind(this);delete this.context}})}Object.defineProperty(q,"state",{configurable:false,enumerable:false,writable:false,value:s});Object.keys(q).forEach(function(w){if(Object.prototype.toString.call(this[w])==="[object Object]"||Object.prototype.toString.call(this[w])==="[object Array]"){Object.freeze(this[w])}}.bind(q));if(!p){Object.freeze(q)}return q};return l}}};h.exports=j},{"./utils":8}],6:[function(j,i,g){var f=j("./utils");var k=f.extend;var h=f.getDescriptor;var e={Mixin:{construct:function(m){var o=h.call(this);o.proto.setState=m;var n=0;var l=function(x,u,w,q){var t;var s;console.log("COUNT - "+ ++n);x=k(x,u);w=w||{};w=("state" in w)?w.state:w;var r=Object.create(o.proto,o.descriptor);Object.defineProperty(r,"state",{configurable:true,enumerable:false,writable:true,value:x});x=k(x,r);if(q){if(o.proto.getInitialState){x=k(x,o.proto.getInitialState())}if(!!o.originalSpec.getInitialCalculatedState){for(var p=o.calculatedFields.length-1;p>=0;p--){if(!(o.calculatedFields[p] in x)||x[o.calculatedFields[p]]===void (0)){s={};s[o.calculatedFields[p]]=o.originalSpec.getInitialCalculatedState.call(r,x,w)[o.calculatedFields[p]];if(s[o.calculatedFields[p]]!==void (0)){x=k(x,s)}}}}}if(o.originalSpec.getValidState){x=k(x,o.originalSpec.getValidState.call(r,x,w))}Object.defineProperty(r,"state",{configurable:false,enumerable:false,writable:false,value:x});Object.keys(r).forEach(function(y){if(Object.prototype.toString.call(this[y])==="[object Object]"&&("context" in this[y])){this[y].context=this;Object.freeze(this[y])}else{if(Object.prototype.toString.call(this[y])==="[object Array]"){Object.freeze(this[y])}}}.bind(r));for(var v in u){if(u.hasOwnProperty(v)&&v[0]!=="_"){Object.defineProperty(r,v,{configurable:false,enumerable:false,writable:false,value:u[v]})}}Object.freeze(x);return Object.freeze(r)};return l}}};i.exports=e},{"./utils":8}],7:[function(j,i,h){var f=j("./core");var e="__IMVVM__";var g={stateChangedHandler:function(k,l,m){this.setState({applicationDataContext:k},function(){if(typeof m==="function"){if(this.state===null||!("applicationDataContext" in this.state)){m(void (0))}else{if(l in this.state.applicationDataContext){m(this.state.applicationDataContext[l])}else{if(l===e){m(this.state.applicationDataContext)}else{m(void (0))}}}}}.bind(this))},getInitialState:function(){var k=f.getInitialState(e,this.props.domainModel,this.stateChangedHandler,this.props.disableUndo);return{applicationDataContext:k}}};i.exports=g},{"./core":2}],8:[function(h,g,f){var e={getDescriptor:function(){var l={};var k=this.prototype;var i=[];for(var j in this.originalSpec){if(this.originalSpec.hasOwnProperty(j)){if("get" in this.originalSpec[j]||"set" in this.originalSpec[j]){if("calculated" in this.originalSpec[j]){l[j]=e.extend(this.originalSpec[j]);l[j].enumerable=this.originalSpec[j].calculated;delete l[j].calculated;i.push(j)}else{if(!("enumerable" in this.originalSpec[j])){if("pseudo" in this.originalSpec[j]){this.originalSpec[j].enumerable=!this.originalSpec[j].pseudo;delete this.originalSpec[j].pseudo}else{this.originalSpec[j].enumerable=true}l[j]=this.originalSpec[j]}else{l[j]=this.originalSpec[j]}}}else{k[j]=this.originalSpec[j]}}}if(!("extend" in k)){k.extend=e.extend}return{descriptor:l,proto:k,originalSpec:this.originalSpec||{},calculatedFields:i}},extend:function(){var j={};for(var l=0;l<arguments.length;l++){var m=arguments[l];for(var k in m){if(m.hasOwnProperty(k)){j[k]=m[k]}}}return j},mixInto:function(j,k){var i;for(i in k){if(!k.hasOwnProperty(i)){continue}j.prototype[i]=k[i]}}};g.exports=e},{}]},{},[1])(1)});